---
title: "Javaç¼–è¯‘å™¨çš„ã€Œæ¶ˆå¤±é­”æœ¯ã€"
date: 2025-02-22
draft: false
tags: ["é¢è¯•","Java","éšç¬”"]
slug: "java-generics-impl"
---


## ä»£ç ä¸–ç•Œçš„"æ™ºèƒ½åˆ†ç±»å™¨"
ä½ æœ‰ä¸€ä¸ªç¥å¥‡çš„ç›’å­ï¼Œå®ƒèƒ½è‡ªåŠ¨è¯†åˆ«æ”¾å…¥çš„ç‰©å“ç±»å‹ã€‚æ³›å‹å°±åƒè¿™ä¸ªç›’å­çš„æ ‡ç­¾ç³»ç»Ÿï¼š
- **æ²¡æœ‰æ³›å‹**ï¼šç›’å­æ˜¯ä¸ª"æ‚ç‰©ç®±"ï¼Œå¯èƒ½æ··è£…ä¹¦æœ¬å’Œæ°´æœï¼ˆç¼–è¯‘ä¸æŠ¥é”™ï¼Œä½†å–å‡ºæ—¶å¯èƒ½å‡ºé”™ï¼‰ï¼›
    ```java
    // æ™®é€šç›’å­ï¼ˆå¯èƒ½è£…é”™ä¸œè¥¿ï¼‰
    Box rawBox = new Box();
    rawBox.put(123);          // ç¼–è¯‘é€šè¿‡
    String book = (String)rawBox.get(); // è¿è¡Œæ—¶çˆ†ç‚¸ğŸ’¥
    ```
- **ä½¿ç”¨æ³›å‹**ï¼šç›’å­å˜æˆ"ä¸“ç”¨æ”¶çº³ç›’"ï¼Œåªèƒ½æ”¾æŒ‡å®šç±»å‹ç‰©å“ï¼ˆå¦‚`Box<String>`åªæ¥å—å­—ç¬¦ä¸²ï¼‰ï¼›
    ```java
    // æ³›å‹ç›’å­ï¼ˆæ™ºèƒ½åˆ†ç±»ï¼‰
    Box<String> safeBox = new Box<>();
    safeBox.put(123);         // ç¼–è¯‘ç›´æ¥æŠ¥é”™ğŸš«
    String book = safeBox.get(); // ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¼ºåˆ¶è½¬æ¢
    ```

## ç±»å‹æ“¦é™¤çš„"ä¸‰æ­¥æ¶ˆå¤±æœ¯"
Javaä¸­çš„æ³›å‹æ˜¯é€šè¿‡ä¸€ç§ç§°ä¸º**ç±»å‹æ“¦é™¤**çš„æœºåˆ¶å®ç°çš„ã€‚åœ¨ç¼–è¯‘ç”Ÿæˆ`.class`æ–‡ä»¶ä¹‹åï¼Œæºä»£ç ä¸­æ‰€æœ‰çš„æ³›å‹ä¿¡æ¯éƒ½ä¼šè¢«ç§»é™¤ï¼Œå¯ä»¥è®¤ä¸ºæºä»£ç ä¸­æ³›å‹ç›¸å…³çš„ä¿¡æ¯ï¼Œå°±æ˜¯æä¾›ç»™ç¼–è¯‘å™¨ç”¨ã€‚
æ³›å‹ä¿¡æ¯å¯¹Javaç¼–è¯‘å™¨å¯è§ï¼Œä½†åœ¨è¿è¡Œæ—¶å¯¹Javaè™šæ‹Ÿæœºä¸å¯è§ã€‚

æ ¹æ®Java[å®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/javase/tutorial/java/generics/erasure.html)çš„è§£é‡Šï¼Œä¸ºäº†å®ç°æ³›å‹ï¼ŒJavaç¼–è¯‘å™¨åº”ç”¨äº†ä»¥ä¸‹æ­¥éª¤ï¼š
1. **ç±»å‹æ£€æŸ¥**ï¼šå½“ä½ å†™æ³›å‹ä»£ç æ—¶ï¼ŒJavaç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿ä½ ä½¿ç”¨çš„ç±»å‹æ˜¯æ­£ç¡®çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å£°æ˜ä¸€ä¸ª`List<String>`ï¼Œç¼–è¯‘å™¨ä¼šç¡®ä¿ä½ åªèƒ½å‘è¿™ä¸ªåˆ—è¡¨æ·»åŠ å­—ç¬¦ä¸²ï¼›
    ```java
    // æ³›å‹ç›’å­ï¼ˆæ™ºèƒ½åˆ†ç±»ï¼‰
    Box<String> safeBox = new Box<>();
    safeBox.put(123);         // ç¼–è¯‘ç›´æ¥æŠ¥é”™ğŸš«
    String book = safeBox.get(); // ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¼ºåˆ¶è½¬æ¢
    ```
3. **ç±»å‹æ“¦é™¤**ï¼šä¸€æ—¦ç¼–è¯‘å®Œæˆï¼Œæ‰€æœ‰çš„æ³›å‹ç±»å‹ä¿¡æ¯éƒ½ä¼šè¢«ç§»é™¤ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšâ€œç±»å‹æ“¦é™¤â€ã€‚åœ¨ç±»å‹æ“¦é™¤è¿‡ç¨‹ä¸­ï¼š
    - æ³›å‹ç±»å‹å‚æ•°è¢«æ›¿æ¢ï¼šæ‰€æœ‰çš„æ³›å‹ç±»å‹å‚æ•°ä¼šè¢«æ›¿æ¢ä¸ºå®ƒä»¬çš„ä¸Šç•Œï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šä¸Šç•Œï¼Œå°±æ›¿æ¢ä¸º`Object`ï¼‰ï¼›

    | ä»£ç ä¸­çš„æ³›å‹  | æ“¦é™¤å  | æ›¿æ¢è§„åˆ™  |
    |---|---|---|
    | `List<T>`  | `List`  | `T â†’ Object`  |
    | `List<? extends Cat>`  | `List<Cat>`  | `ä¿ç•™æœ€è¿‘çš„çˆ¶ç±»`  |
    | `Map<K,V>`  | `Map`  | K/V â†’ Object  |
    - æ’å…¥å¿…è¦çš„ç±»å‹è½¬æ¢ï¼šåœ¨å¿…è¦çš„åœ°æ–¹æ’å…¥ç±»å‹è½¬æ¢æ¥ä¿æŒç±»å‹å®‰å…¨ï¼›
    ```java
    // ä½ å†™çš„ä»£ç 
    String name = names.get(0);
    
    // ç¼–è¯‘å™¨æš—ä¸­æ·»åŠ çš„ç±»å‹è½¬æ¢
    String name = (String)names.get(0); // è‡ªåŠ¨æ’å…¥ç±»å‹è½¬æ¢
    ```
3. **æ¡¥æ¥æ–¹æ³•**ï¼šå½“æ³›å‹ç±»è¢«ç»§æ‰¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå»ºé€ ç‰¹æ®Šé€šé“ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆæ¡¥æ¥æ–¹æ³•æ¥ä¿è¯å­ç±»çš„æ–¹æ³•æ­£ç¡®è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼š
   <br>å‡è®¾æœ‰ä¸€ä¸ªçˆ¶ç±»å’Œä¸€ä¸ªå­ç±»ï¼š
    ```java
    class Parent<T> {
        public T getValue() {
            return null;
        }
    }
    
    class Child extends Parent<String> {
        @Override
        public String getValue() {
            return "child value";
        }
    }
    ```
   ç¼–è¯‘åï¼Œ`Child`ç±»ä¸­ä¼šæœ‰ä¸€ä¸ªæ¡¥æ–¹æ³•ï¼š
    ```java
    class Child extends Parent<String> {
        @Override
        public String getValue() {
            return "child value";
        }
    
        // ç”Ÿæˆçš„æ¡¥æ–¹æ³•
        @Override
        public Object getValue() {
            return getValue(); // è°ƒç”¨å®é™…çš„getValueæ–¹æ³•
        }
    }
    ```

## Javaæ³›å‹å…­å¤§é»„é‡‘æ³•åˆ™
1. ğŸ›¡ï¸ **å§‹ç»ˆä½¿ç”¨å‚æ•°åŒ–ç±»å‹**ï¼šåŸç”Ÿç±»å‹å¦‚`List`ä¼šç»•è¿‡ç¼–è¯‘å™¨çš„ç±»å‹æ£€æŸ¥ï¼Œå®¹æ˜“å¯¼è‡´è¿è¡Œæ—¶`ClassCastException`ã€‚å‚æ•°åŒ–ç±»å‹ï¼ˆå¦‚`List<String>`ï¼‰èƒ½åœ¨ç¼–ç é˜¶æ®µå‘ç°ç±»å‹é”™è¯¯ï¼Œç¡®ä¿å®¹å™¨å†…å…ƒç´ çš„ç±»å‹å®‰å…¨ã€‚  
    ```java
    // âŒ å±é™©ï¼šåŸç”Ÿç±»å‹å¯èƒ½æ··å…¥é”™è¯¯ç±»å‹
    List rawList = new ArrayList();
    rawList.add(123);
    String value = (String)rawList.get(0); // è¿è¡Œæ—¶å¼‚å¸¸
    
    // âœ… å®‰å…¨ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹
    List<String> safeList = new ArrayList<>();
    safeList.add("Hello"); 
    String text = safeList.get(0); // æ— éœ€å¼ºåˆ¶è½¬æ¢
    ```
2. ğŸ”„ **ä¼˜å…ˆé€‰æ‹©æ³›å‹æ–¹æ³•**ï¼šæ³›å‹æ–¹æ³•èƒ½é¿å…é‡å¤ä»£ç ï¼ŒåŒæ—¶ä¿æŒç±»å‹å®‰å…¨ã€‚å®ƒä»¬é€šè¿‡ç±»å‹å‚æ•°ï¼ˆå¦‚`<T>`ï¼‰è‡ªåŠ¨é€‚åº”ä¸åŒæ•°æ®ç±»å‹ï¼Œæ¶ˆé™¤å¼ºåˆ¶è½¬æ¢çš„é£é™©ã€‚
    ```java
    // é€šç”¨äº¤æ¢æ–¹æ³•ï¼ˆæ”¯æŒä»»æ„ç±»å‹æ•°ç»„ï¼‰
    public static <T> void swap(T[] array, int i, int j) {
        T temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    String[] words = {"A", "B"};
    swap(words, 0, 1); // è‡ªåŠ¨æ¨æ–­ç±»å‹ä¸ºString
    ```
3. ğŸ§© **åˆç†ä½¿ç”¨é€šé…ç¬¦å¢å¼ºAPIçµæ´»æ€§**ï¼šé€šé…ç¬¦ï¼ˆ`? extends`/`? super`ï¼‰éµå¾ª`PECS`åŸåˆ™ï¼ˆProducer-Extends, Consumer-Superï¼‰ï¼Œè®©APIæ”¯æŒæ›´å¹¿æ³›çš„ç±»å‹èŒƒå›´ã€‚ä¾‹å¦‚`List<? extends Number>`å¯æ¥æ”¶`Integer`æˆ–`Double`é›†åˆã€‚
    ```java
    // ç»Ÿè®¡æ‰€æœ‰æ•°å­—çš„æ€»å’Œï¼ˆæ”¯æŒIntegerã€Doubleç­‰ï¼‰
    public double sum(List<? extends Number> numbers) {
        return numbers.stream()
                      .mapToDouble(Number::doubleValue)
                      .sum();
    }
    
    // è°ƒç”¨ç¤ºä¾‹
    List<Integer> ints = List.of(1, 2, 3);
    sum(ints); // âœ… åˆæ³•
    ```
4. âš¡ **è­¦æƒ•ç±»å‹æ“¦é™¤çš„æ€§èƒ½å½±å“**ï¼šæ³›å‹ç±»å‹ä¿¡æ¯åœ¨ç¼–è¯‘åä¼šè¢«æ“¦é™¤ï¼Œåå°„æ“ä½œï¼ˆå¦‚`getClass()`ï¼‰å¯èƒ½å¸¦æ¥æ€§èƒ½æŸè€—ã€‚é€šè¿‡ç¼“å­˜`Class`å¯¹è±¡æˆ–é¿å…é«˜é¢‘åå°„è°ƒç”¨å¯ä¼˜åŒ–æ€§èƒ½ã€‚
    ```java
    // âŒ ä½æ•ˆï¼šæ¯æ¬¡å¾ªç¯éƒ½è·å–Classå¯¹è±¡
    for (int i = 0; i < 1000; i++) {
        Class<?> clazz = obj.getClass(); // é‡å¤åå°„è°ƒç”¨
    }
    
    // âœ… ä¼˜åŒ–ï¼šç¼“å­˜Classå¼•ç”¨
    Class<?> clazzCache = obj.getClass();
    for (int i = 0; i < 1000; i++) {
        // ä½¿ç”¨å·²ç¼“å­˜çš„clazzCache
    }
    ```
5. ğŸ§ª **å¯¹æ³›å‹åå°„æ“ä½œè¿›è¡Œé˜²å¾¡æ€§æ£€æŸ¥**ï¼šè¿è¡Œæ—¶æ³›å‹ç±»å‹è¢«æ“¦é™¤ï¼Œç›´æ¥å¼ºåˆ¶è½¬æ¢å¯èƒ½æŠ›å‡º`ClassCastException`ã€‚ä½¿ç”¨`instanceof`æˆ–`Class.isInstance()`é¢„å…ˆéªŒè¯ç±»å‹å®‰å…¨æ€§ã€‚
    ```java
    public <T> T safeCast(Object obj, Class<T> targetType) {
        if (targetType.isInstance(obj)) {
            return targetType.cast(obj);
        }
        throw new IllegalArgumentException("ç±»å‹ä¸åŒ¹é…: " + obj.getClass());
    }
    
    // å®‰å…¨ä½¿ç”¨
    Object raw = "Hello";
    String value = safeCast(raw, String.class); // âœ…
    ```
6. ğŸ“¦ **é€šè¿‡å·¥å‚æ¨¡å¼å°è£…å¤æ‚æ³›å‹åˆ›å»º**ï¼šå¤æ‚çš„æ³›å‹å£°æ˜ï¼ˆå¦‚`Map<String`,`List<Map<Integer, String>>>`ï¼‰ä¼šé™ä½ä»£ç å¯è¯»æ€§ã€‚å·¥å‚æ–¹æ³•èƒ½éšè—å®ç°ç»†èŠ‚ï¼Œç®€åŒ–å®¢æˆ·ç«¯ä»£ç ã€‚
    ```java
    public class CollectionFactory {
        public static <K, V> Map<K, V> createMap() {
            return new HashMap<>();
        }
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    Map<String, List<String>> complexMap = CollectionFactory.createMap();
    // æ¯”ç›´æ¥å†™ new HashMap<String, List<String>>() æ›´ç®€æ´
    ```