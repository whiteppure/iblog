<!DOCTYPE html>
<html lang="zh" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="whitepure" />
	
	
	
	<title>分布式微服务治理 ｜ whitepure</title>
	
    
    
    <meta name="description" content="什么是微服务架构 In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use" />
    

    
    
    <meta name="keywords" content="whitepure博客, whiteppure, whitepure" />
    

	
    
    <link rel="shortcut icon" href="https://whiteppure.github.io/iblog/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/iblog/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/iblog/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/iblog/css/highlight.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://whiteppure.github.io/iblog/css/toc.css" />

    
    
</head>

<body>
    
    
    









<div class="toc">

    <div class="page-header"><strong>- CATALOG -</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%9e%b6%e6%9e%84">
                    什么是微服务架构
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e4%bd%bf%e7%94%a8%e5%be%ae%e6%9c%8d%e5%8a%a1">
                    为什么要使用微服务
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#springcloud">
                    SpringCloud
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e6%b3%a8%e5%86%8c%e5%8f%91%e7%8e%b0">
                    服务注册发现
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#eureka">
                    Eureka
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e7%86%94%e6%96%ad%e9%99%8d%e7%ba%a7">
                    服务熔断降级
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#hystrix">
                    Hystrix
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e7%bd%91%e5%85%b3">
                    服务网关
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#getway">
                    GetWay
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e8%b0%83%e7%94%a8">
                    服务调用
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#openfeign">
                    OpenFeign
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e8%b4%9f%e8%bd%bd">
                    服务负载
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#ribbon">
                    Ribbon
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae%e4%b8%ad%e5%bf%83">
                    服务配置中心
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#springcloud-config">
                    SpringCloud Config
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91">
                    服务开发
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link text-left" href="#springboot">
                    SpringBoot
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        

    </div>

</div>



    
    <div class="main animate__animated animate__fadeInDown" id="pdf_content">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul><li class="">
                <a href="https://whiteppure.github.io/iblog/">首页</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/iblog/posts/">归档</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/iblog/tags/">标签</a>
            </li><li class="">
                <a href="https://whiteppure.github.io/iblog/about/">关于</a>
            </li>
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://whiteppure.github.io/iblog/">
                    <span>whitepure</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">
                知行合一
            </p>
            <div class="my_socials">
                
                
                <a href="https://github.com/whiteppure/" title="github" target="_blank">
                    <i class="ri-github-fill"></i>
                </a>
                
                
                <a href="https://whiteppure.github.io/iblog/index.xml" type="application/rss+xml" title="rss" target="_blank">
                    <i class="ri-rss-fill"></i>
                </a>
                



            </div>
            
            <div class="post">
                <div class="post_title post_detail_title">
                    <span class="date" id="busuanzi_container_site_pv">访问量 <span id="busuanzi_value_site_pv"></span>次</span>
                </div>
                <div class="post_title post_detail_title">
                    <span class="date" id="busuanzi_container_site_uv">访客数 <span id="busuanzi_value_site_uv"></span>人</span>
                </div>
            </div>
            
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/iblog/posts/essays/java-small-service/'>分布式微服务治理</a></h2>
                        <span class="date">2021.06.21</span>
                    </div>
                    <div class="post_content markdown"><h2 id="什么是微服务架构">什么是微服务架构</h2>
<blockquote>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services,
each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API.
These services are built around business capabilities and independently deployable by fully automated deployment machinery.
There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies. ——<a href="https://martinfowler.com/articles/microservices.html">James Lewis and Martin Fowler (2014)</a></p>
</blockquote>
<p>大意：简而言之，微服务体系结构风格是一种将单个应用程序开发为一套小型服务的方法，每个服务运行在自己的进程中，并与轻量级机制(通常是HTTP资源API)通信。
这些服务是围绕业务功能构建的，可以通过全自动部署机制进行独立部署。对这些服务的集中管理是最低限度的，这些服务可能用不同的编程语言编写，并使用不同的数据存储技术。</p>
<p>微服务是一种架构风格，将服务围绕业务功能拆分，一个应用拆分为一组小型服务，每个服务运行在自己的进程内，也就是可独立部署和升级，服务之间使用轻量级HTTP交互，可以由全自动部署机制独立部署，去中心化，服务自治。服务可以使用不同的语言、不同的存储技术。</p>
<h2 id="为什么要使用微服务">为什么要使用微服务</h2>
<p>说的微服务就不得不说微服务之前的单体应用，有对比才能看的出微服务对比之前的单体应用到底强在哪？为什么我们要抛弃单体应用？</p>
<ul>
<li>单体应用往往所有的功能打包在一个包里，包含了 DO/DAO，Service，UI等所有逻辑，如果要修改一部分代码就需要全部重新部署，所以改动影响大，风险高。微服务模式弥补了这个缺陷，它将应用合理的拆分，实现敏捷开发和快速部署。</li>
<li>单体应用只能通过在负载均衡器后面放置整个应用程序的多个实例来进行水平扩展，如果想要扩展特定的程序，显然是不行的，则需要使用到微服务模式实现。</li>
<li>因为单体应用所有的功能全部都达到一个包里面，所以耦合性比较强，对于程序员来说代码维护会收到影响，出现了什么问题也不太方便进行排查。</li>
<li>如果没有正确的设计，单体应用的一部分失败可能会级联并导致整个系统崩溃。而这种情况可以使用微服务的熔断、降级的思想来解决。</li>
</ul>
<p>微服务虽然好处多多，但是缺点就是服务众多，治理成本高，不利于维护系统，项目成本会升高，所以项目架构设计时应综合考量。
建议设计的原则是业务驱动、设计保障、演进式迭代、保守治疗的方式。搞不清楚，有争议的地方先尽量不要拆，如果确实要拆，要经过业务分析后慎重设计，把真正相对独立的部分拆分出来，可以借鉴 <strong>DDD</strong> 的方式。拆了以后要观察微服务的接口是否稳定，针对业务需求的变更微服务的模块是否可以保持相对稳定，是否可以独立演进。</p>
<blockquote>
<p>DDD: Domain-driven design的简称，译为领域驱动设计，是一种通过将实现连接到持续进化的模型来满足复杂需求的软件开发方法。
<br>
核心思想：DDD其实是面向对象方法论的一个升华。无外乎是通过划分领域（聚合根、实体、值对象）、领域行为封装到领域对象（充血模式）、内外交互封装到防腐层、职责封装到对应的模块和分层，从而实现了高内聚低耦合。
链接：<a href="https://blog.csdn.net/qq_31960623/article/details/119840131">https://blog.csdn.net/qq_31960623/article/details/119840131</a></p>
</blockquote>
<h2 id="springcloud">SpringCloud</h2>
<p>随着微服务模式的使用，服务之间的调用带来的问题有很多，例如：数据一致性、网络波动、缓存、事务等问题，针对这一系列的问题就要有对应的框架来解决，目前主流一站式微服务解决方案有<code>Spring Cloud</code>、<code>Spring Cloud Alibaba</code>。</p>
<p><code>Spring Cloud</code>它并不是一个框架，而是很多个框架。它是分布式微服务架构的一站式解决方案，是多种微服务架构落地技术的集合体，俗称微服务全家桶。</p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-001.png" alt="分布式架构-001"></p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-010.png" alt="分布式架构-010"></p>
<h3 id="服务注册发现">服务注册发现</h3>
<p>在服务注册与发现中，有一个注册中心。当服务器启动的时候，会把当前自己服务器的信息比如服务地址通讯地址等以别名方式注册到注册中心上。另一方消费者服务提供者，以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再实现本地RPC调用。RPC远程调用框架核心设计思想:在于注册中心，因为使用注册中心管理每个服务与服务之间的一个依赖关系。在任何RPC远程框架中，都会有一个注册中心存放服务地址相关信息。</p>
<h4 id="eureka">Eureka</h4>
<p>参考文章：</p>
<ul>
<li><a href="https://www.jianshu.com/p/cb7fa0aa47a8">https://www.jianshu.com/p/cb7fa0aa47a8</a></li>
</ul>
<blockquote>
<p>Eureka is a REST (Representational State Transfer) based service that is primarily used in the AWS cloud for locating services for the purpose of load balancing and failover of middle-tier servers. We call this service, the Eureka Server. Eureka also comes with a Java-based client component,the Eureka Client, which makes interactions with the service much easier. The client also has a built-in load balancer that does basic round-robin load balancing. &mdash;<a href="https://github.com/Netflix/eureka">https://github.com/Netflix/eureka</a></p>
</blockquote>
<p>大意：Eureka是一个REST (Representational State Transfer)服务，它主要用于AWS云，用于定位服务，以实现中间层服务器的负载平衡和故障转移，我们称此服务为Eureka服务器。Eureka也有一个基于java的客户端组件，Eureka客户端，这使得与服务的交互更加容易，同时客户端也有一个内置的负载平衡器，它执行基本的循环负载均衡。</p>
<p>Eureka采用了CS的设计架构，Eureka Sever作为服务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使用Eureka的客户端连接到 Eureka Server并维持心跳连接。这样系统的维护人员就可以通过Eureka Server来监控系统中各个微服务是否正常运行。</p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-002.png" alt="分布式架构-002"></p>
<ul>
<li>Eureka Server 提供服务注册服务；各个微服务节点通过配置启动后，会在EurekaServer中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观看到。</li>
<li>Eureka Client 通过注册中心进行访问；它是一个Java客户端，用于简化Eureka Server的交互，客户端同时也具备一个内置的使用轮询负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳默认周期为30秒。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，Eureka Server将会从服务注册表中把这个服务节点移除，默认90秒。
<ul>
<li>Service Provider：服务提供方，将自身服务注册到Eureka，从而使服务消费方能够找到；</li>
<li>Service Consumer：服务消费方，从Eureka获取注册服务列表，从而能够消费服务；</li>
</ul>
</li>
</ul>
<p><strong>Eureka的自我保护机制：</strong></p>
<p>默认情况下，如果Eureka Server在一定时间内（默认90秒）没有接收到某个微服务实例的心跳，Eureka Server将会移除该实例。但是当网络分区故障发生时，微服务与Eureka Server之间无法正常通信，而微服务本身是正常运行的，此时不应该移除这个微服务，所以引入了自我保护机制。</p>
<blockquote>
<p>自我保护模式正是一种针对网络异常波动的安全保护措施，使用自我保护模式能使Eureka集群更加的健壮、稳定的运行。</p>
</blockquote>
<p>如果在15分钟内超过85%的客户端节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，Eureka Server自动进入自我保护机制：</p>
<ul>
<li>Eureka Server不再从注册列表中移除因为长时间没收到心跳而应该过期的服务；</li>
<li>Eureka Server仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上，保证当前节点依然可用；</li>
<li>当网络稳定时，当前Eureka Server新的注册信息会被同步到其它节点中；</li>
</ul>
<p>简而言之，某时刻某一个微服务不可用了，Eureka不会立刻清理，依旧会对该微服务的信息进行保存。所以Eureka属于<a href="https://blog.csdn.net/white_pure/article/details/119806058">AP</a>。</p>
<h3 id="服务熔断降级">服务熔断降级</h3>
<p>由于分布式架构中应用程序依赖关系可能非常多，每个依赖关系在某些时候将不可避免地失败，针对服务调用失败，为了缩小调用失败的影响，引入了服务熔断降级的思想。</p>
<p>多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和微服务C又调用其它的微服务，这就是所谓的“扇出”。如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”.</p>
<ul>
<li>服务熔断：熔断机制是应对雪崩效应的一种微服务链路保护机制，当链路的某个微服务不可用或者响应时间太长时，将快速的返回设置好的提示信息。</li>
<li>服务降级：服务降级一般是指在服务器压力剧增的时候，根据实际业务使用情况以及流量，对一些服务和页面有策略的不处理或者用一种简单的方式进行处理，从而释放服务器资源的资源以保证核心业务的正常高效运行。</li>
</ul>
<p>服务熔断是应对系统服务雪崩的一种保险措施，给出的一种特殊降级措施。而服务降级则是更加宽泛的概念，主要是对系统整体资源的合理分配以应对压力。服务熔断可看作特殊降级。</p>
<h4 id="hystrix">Hystrix</h4>
<p>Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</p>
<blockquote>
<p>&ldquo;断路器”本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝)，向调用方返回一个符合预期的、可处理的备选响应（FallBack)，而不是长时间的等待或者抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。</p>
</blockquote>
<p>&ldquo;断路器&quot;思想：<a href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-003.png" alt="分布式架构-003"></p>
<ul>
<li>熔断打开：请求不再进行调用当前服务，内部定时一般为MTTR(平均故障处理时间)，当打开时长达到所设的时长则进入半熔断状态；</li>
<li>熔断半开：部分请求根据规则调用当前服务，如果请求成功且符合规则则认为当前服务恢复正常，关闭熔断；</li>
<li>熔断关闭：熔断关闭不会对服务进行熔断；</li>
</ul>
<p><strong><a href="https://github.com/Netflix/Hystrix/wiki/How-it-Works#Flow">Hystrix工作流程</a>：</strong></p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-004.png" alt="分布式架构-004"></p>
<ol>
<li>创建<code>HystrixCommand</code>或<code>HystrixObserableCommand</code>对象。</li>
<li>命令执行:
<ul>
<li>其中<code>HystrixCommand</code>实现了下面前两种执行方式:
<ul>
<li><code>execute</code>：同步执行，从依赖的服务返回一个单一的结果对象或是在发生错误的时候抛出异常。</li>
<li><code>queue</code>：异步执行，直接返回一个Future对象，其中包含了服务执行结束时要返回的单一结果对象。</li>
</ul>
</li>
<li><code>HystrixObservableCommand</code>实现了后两种执行方式：
<ul>
<li><code>obseve()</code>：返回Observable对象，它代表了操作的多个结果，它是一个Hot Observable,不论“事件源”是否有“订阅者”，都会在创建后对事件进行发布，所以对于Hot Observable的每一个“订阅者”都有可能是从“事件源”的中途开始的，并可能只是看到了整个操作的局部过程。</li>
<li><code>toObservable()</code>：同样会返回Observable对象，也代表了操作的多个结果，但它返回的是一个Cold Observable,没有“订间者”的时候并不会发布事件，而是进行等待，直到有“订阅者&quot;之后才发布事件，所以对于Cold Observable 的订阅者，它可以保证从一开始看到整个操作的全部过程。</li>
</ul>
</li>
</ul>
</li>
<li>判断当前命令的请求缓存功能是被启用的，并且该命令缓存命中，那么缓存的结果会立即以Observable对象的形式返回。</li>
<li>检查断路器是否为打开状态。如果断路器是打开的，那么Hystrix不会执行命令，而是转接到fallback处理逻辑(第8步)；如果断路器是关闭的，检查是否有可用资源来执行命令(第5步)。</li>
<li>判断线程池/请求队列信号量是否占满。如果命令依赖服务的专有线程地和请求队列，或者信号量已经被占满，那么Hystrix也不会执行命令，而是转接到fallback处理理辑(第8步) 。</li>
<li>Hystrix会根据我们编写的方法来决定采取什么样的方式去请求依赖服务:
<ul>
<li><code>HystrixCommand.run()</code>：返回一个单一的结果，或者抛出异常。</li>
<li><code>HystrixObservableCommand.construct()</code>：返回一个Observable对象来发射多个结果，或通过onError发送错误通知。</li>
</ul>
</li>
<li>Hystrix会将“成功”、“失败”、“拒绝”、“超时” 等信息报告给断路器，而断路器会维护一组计数器来统计这些数据。断路器会使用这些统计数据来决定是否要将断路器打开，来对某个依赖服务的请求进行&quot;熔断/短路&rdquo;。</li>
<li>当命令执行失败的时候，Hystrix会进入fallback尝试回退处理，我们通常也称波操作为“服务降级”。而能够引起服务降级处理的情况有下面几种：
<ul>
<li>第4步∶当前命令处于“熔断/短路”状态，断路器是打开的时候。</li>
<li>第5步∶当前命令的线程池、请求队列或者信号量被占满的时候。</li>
<li>第6步∶<code>HystrixObsevableCommand.construct()</code>或<code>HytrixCommand.run()</code>抛出异常的时候。</li>
</ul>
</li>
<li>当Hystrix命令执行成功之后，它会将处理结果直接返回或是以Observable的形式返回给调用方。</li>
</ol>
<h3 id="服务网关">服务网关</h3>
<p>参考文章：</p>
<ul>
<li><a href="https://blog.csdn.net/rain_web/article/details/102469745">https://blog.csdn.net/rain_web/article/details/102469745</a></li>
<li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-starter">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway</a></li>
</ul>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-005.png" alt="分布式架构-005"></p>
<p>网关的角色是作为一个 API 架构，用来保护、增强和控制对于 API 服务的访问。API 网关是一个处于应用程序或服务（提供 REST API 接口服务）之前的系统，用来管理授权、访问控制和流量限制等，这样 REST API 接口服务就被 API 网关保护起来，对所有的调用者透明。因此，隐藏在 API 网关后面的业务系统就可以专注于创建和管理服务，而不用去处理这些策略性的基础设施。</p>
<p>网关作用：</p>
<ul>
<li>作为所有API接口服务的请求接入点；</li>
<li>作为所有后端业务服务的聚合点；</li>
<li>实现安全、验证、路由、过滤、流量等策略；</li>
<li>对所有API服务和策略进行统一管理；</li>
</ul>
<h4 id="getway">GetWay</h4>
<p>Spring Cloud Gateway是Spring官方基于Spring 5.0，Spring Boot 2.0和Project Reactor等技术开发的网关，Spring Cloud Gateway旨在为微服务架构提供一种简单而有效的统一的API路由管理方式。Spring Cloud Gateway作为Spring Cloud生态系中的网关，目标是替代ZUUL，其不仅提供统一的路由方式，并且基于Filter链的方式提供了网关基本的功能，例如：安全，监控/埋点，和限流等。</p>
<p>核心组件：</p>
<ul>
<li>Route - 路由是构建网关的基本模块,它由ID,目标URI,一系列的断言和过滤器组成,如断言为true则匹配该路由；</li>
<li>Predicate - 断言参考的是Java8的<code>java.util.function.Predicate</code>，开发人员可以匹配HTTP请求中的所有内容，例如请求头或请求参数,如果请求与断言相匹配则进行路由；</li>
<li>Filter - 过滤指的是Spring框架中GatewayFilter的实例,使用过滤器,可以在请求被路由前或者之后对请求进行修改；</li>
</ul>
<p>工作流程：
<img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-006.png" alt="分布式架构-006"></p>
<p>客户端向Spring Cloud Gateway发出请求。然后在Gateway Handler Mapping 中找到与请求相匹配的路由，将其发送到GatewayWeb Handler，Handler再通过指定的过滤器链来将请求发送到我们实际的服务执行业务逻辑，然后返回。</p>
<p>过滤器分为前置过滤器和后置过滤器，可以在发送代理请求之前或之后执行业务逻辑。</p>
<ul>
<li>前置过滤器可以做参数校验、权限校验、流量监控、日志输出、协议转换等；</li>
<li>后置过滤器可以做响应内容、响应头的修改，日志的输出，流量监控等。</li>
</ul>
<h3 id="服务调用">服务调用</h3>
<p>参考文章：</p>
<ul>
<li><a href="https://www.jianshu.com/p/a6ad30738140">https://www.jianshu.com/p/a6ad30738140</a></li>
<li><a href="https://github.com/OpenFeign/feign">https://github.com/OpenFeign/feign</a></li>
<li><a href="https://blog.csdn.net/qq_34978129/article/details/111183323">https://blog.csdn.net/qq_34978129/article/details/111183323</a></li>
<li><a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign">https://cloud.spring.io/spring-cloud-static</a></li>
</ul>
<p>服务调用可以说是微服务中最关键的，如果没有服务调用不会出现熔断降级、也不会出现服务负载、服务注册，分布式的服务治理可以说是围绕服务调用展开的。</p>
<p>常见的服务之间的调用方式有两种：</p>
<ul>
<li>RPC远程过程调用：定义数据式，基于原生TCP通信，速度快，效率高。早期的wedservice，现在热门的dubbo，都是RPC的典型代表；</li>
<li>Http：http其实是一种网络传输协议，基于TCP，规定了数据传输的格式。现在客户端浏览器与服务器端通信基本都是采用HTTP协议，也可以用来进行远程服务调用。缺点是消息封装臃肿，优势是对服务的提供和调用方没有任何技术限定，自由灵活，更符合为服务理念；</li>
</ul>
<p>现在热门的Rest风格，就可以通过HTTP协议来实现，如果公司全部采用Java技术栈，那么使用Dubbo作为微服务框架是一个不错的选择；如果公司的技术栈多样化，而且你更青睐Spring家族，那么SpringCloud搭建微服务是不二之选。</p>
<h4 id="openfeign">OpenFeign</h4>
<blockquote>
<p>Feign is a declarative web service client. It makes writing web service clients easier. To use Feign create an interface and annotate it. It has pluggable annotation support including Feign annotations and JAX-RS annotations. Feign also supports pluggable encoders and decoders. Spring Cloud adds support for Spring MVC annotations and for using the same HttpMessageConverters used by default in Spring Web. Spring Cloud integrates Ribbon and Eureka, as well as Spring Cloud LoadBalancer to provide a load-balanced http client when using Feign.</p>
</blockquote>
<p>大意：Feign是一个声明式WebService客户端。使用Feign能让编写Web Service客户端更加简单。它的使用方法是定义一个服务接口然后在上面添加注解。Feign也支持可拔插式的编码器和解码器。Spring Cloud对Feign进行了封装，使其支持了Spring MVC标准注解和HttpMessageConverters。Feign可以与Eureka和Ribbon组合使用以支持负载均衡。</p>
<p>Feign和OpenFeign:</p>
<ul>
<li>Feign是Spring Cloud组件中的一个轻量级RESTful的HTTP服务客户端Feign内置了Ribbon，用来做客户端负载均衡，去调用服务注册中心的服务。Feign的使用方式是:使用Feign的注解定义接口，调用这个接口，就可以调用服务注册中心的服务；</li>
<li>OpenFeign是Spring Cloud在Feign的基础上支持了SpringMVC的注解，如@RequesMapping等等。OpenFeign的@Feignclient可以解析SpringMVc的@RequestMapping注解下的接口，并通过动态代理的方式产生实现类，实现类中做负载均衡并调用其他服务；</li>
</ul>
<p>通过使用<code>OpenFeign</code>可以使代码变得更加简洁，减轻程序员负担：</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"> // 伪代码
 @Component
 // 括号中，为在注册中心注册的服务名称
 @FeignClient(&#34;CLOUD-PAYMENT-SERVICE&#34;)
 public interface PaymentFeignService {
 
     @GetMapping(&#34;/payment/get/{id}&#34;)
     CommonResult&lt;Payment&gt; getPayment(@PathVariable(&#34;id&#34;) Long id);
 
     @PostMapping(&#34;/payment/timeout&#34;)
     String feignTimeoutTest();
 }
</code></pre></div><p>openFeign工作原理：</p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-008.png" alt="分布式架构-008"></p>
<ol>
<li>使用注解<code>@FeignClient</code>注册<code>FactoryBean</code>到IOC容器, 最终产生了一个虚假的实现类代理;</li>
<li>使用Feign调用接口的地方，最终拿到的都是一个假的代理实现类；</li>
<li>所有发生在代理实现类上的调用，都被转交给Feign框架，翻译成HTTP的形式发送出去，并得到返回结果，再翻译回接口定义的返回值形式；</li>
</ol>
<h3 id="服务负载">服务负载</h3>
<blockquote>
<p>负载均衡，英文名称为Load Balance，其含义就是指将工作任务进行平衡、分摊到多个操作单元上进行运行，例如FTP服务器、Web服务器、企业核心应用服务器和其它主要任务服务器等，从而协同完成工作任务。</p>
</blockquote>
<p>当前服务与服务之间进行相互调用时，在分布式架构下应用都是集群部署，所以这个时候就需要进行服务负载，即将收到的请求分摊到对应的服务器上，从而达到系统的高可用。</p>
<p>常见负载均衡算法：</p>
<ul>
<li>随机分配：随机选择一台服务器来分配任务。它保证了请求的分散性达到了均衡的目的。同时它是没有状态的不需要维持上次的选择状态和均衡因子。但是随着任务量的增大，它的效果趋向轮询后也会具有轮询算法的部分缺点；</li>
<li>轮询分配：将任务分配给此时具有最小连接数的节点，因此它是动态负载均衡算法。一个节点收到一个任务后连接数就会加1，当节点故障时就将节点权值设置为0，不再给节点分配任务；</li>
<li>最小连接分配：将任务分配给此时具有最小连接数的节点，因此它是动态负载均衡算法。一个节点收到一个任务后连接数就会加1，当节点故障时就将节点权值设置为0，不再给节点分配任务；</li>
<li>hash分配：对请求中的关键信息进行hash计算，hash值相同的请求分配到同一台服务器，具体原理可查看HashMap分配原理；</li>
<li>根据性能分配：根据服务器的响应时间来进行任务分配，优先将新任务分配给响应最快的服务器；</li>
</ul>
<h4 id="ribbon">Ribbon</h4>
<p>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套客户端负载均衡的工具，是一个内置软件负载平衡器的进程间通信（远程过程调用）库。主要功能是提供客户端的软件负载均衡算法和服务调用。Ribbon客户端组件提供一系列完善的配置项，如连接超时、重试等。</p>
<p>本地负载与服务端负载：</p>
<ul>
<li>Nginx是服务器负载均衡，客户端所有请求都会交给nginx，然后由nginx实现转发请求。即负载均衡是由服务端实现的；</li>
<li>Ribbon是本地负载均衡，在调用微服务接口时候，会在注册中心上获取注册信息服务列表之后缓存到JVM本地，从而在本地实现RPC远程服务调用技术；</li>
</ul>
<p>Ribbon其实是一个软负载均衡的客户端组件，它可以和其他所需请求的客户端结合使用，例如与Eureka结合：</p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-007.png" alt="分布式架构-007"></p>
<p>消费方和服务方在注册中心注册服务，当消费方发起请求时，Ribbon会去注册中心寻找请求的服务名，即服务方集群，Ribbon默认负载算法会根据<code>接口第几次请求 % 服务器集群总数量</code>算出实际消费方服务器的位置，每次服务重启动后rest接口计数从1开始。</p>
<p>模拟Ribbon默认负载均衡算法：</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">public interface ILoadBalance {
    ServiceInstance instance(List&lt;ServiceInstance&gt; instances); 
}
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">@Component
public class MyLoadBalance implements ILoadBalance{

    /**
     * 轮询索引
     */
    private final AtomicInteger index = new AtomicInteger(0);

    /**
     * 负载均衡算法：rest接口第几次请求数 % 服务器集群总数量 = 实际调用服务器位置下标，每次服务重启动后rest接口计数从1开始。
     * @param instances 服务器集群数量
     * @return 实际服务器的下标
     */
    @Override
    public ServiceInstance instance(List&lt;ServiceInstance&gt; instances) {
        return instances.get(incrementAndGet() % instances.size());
    }

    public final int incrementAndGet() {
        int current = 0;
        int next = 0;
        do {
            current = index.get();
            // 当最大数量超过 Integer.MAX_VALUE 归0
            next = current &gt;= 2147483647 ? 0 : current + 1;
        }while (!index.compareAndSet(current,next));
        return next;
    }
}
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"> @Resource
 private RestTemplate restTemplate;

 @Resource
 private DiscoveryClient discoveryClient;

 @Resource
 private ILoadBalance iLoadBalance;

 @GetMapping(&#34;/myLoadBalance&#34;)
 public String myLoadBalanceTest() {

     List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&#34;CLOUD-PAYMENT-SERVICE&#34;);
     ServiceInstance instance = iLoadBalance.instance(instances);

     URI uri = instance.getUri();
     String finalUri = String.format(&#34;%s/%s&#34;, uri, PaymentConstant.PAYMENT_GETPORT_API);

     log.info(&#34;自定义负载均衡,请求地址：{}&#34;, finalUri);

     return restTemplate.getForObject(finalUri, String.class);
 }
</code></pre></div><h3 id="服务配置中心">服务配置中心</h3>
<p>在分布式微服务意味着要将单体应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务。由于每个服务都需要必要的配置信息才能运行，所以一套集中式的、动态的配置管理设施是必不可少的。</p>
<p>配置中心应运而生。配置中心，顾名思义，就是来统一管理项目中所有配置的系统。对于单机版，我们称之为配置文件；对于分布式集群系统，我们称之为配置中心。</p>
<p>配置中心作用：</p>
<ul>
<li>统一管理不同环境、不同集群的配置；</li>
<li>将配置与应用分离、解耦合；</li>
<li>版本发布管理；</li>
</ul>
<h4 id="springcloud-config">SpringCloud Config</h4>
<p>参考文章：</p>
<ul>
<li><a href="https://www.springcloud.cc/spring-cloud-config.html">https://www.springcloud.cc/spring-cloud-config.html</a></li>
<li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html">https://cloud.spring.io/spring-cloud-static/spring-cloud-config</a></li>
</ul>
<p>SpringCloud Config为微服务架构中的微服务提供集中化的外部配置支持，配置服务器为各个不同微服务应用的所有环境提供了一个中心化的外部配置。</p>
<p><img src="/iblog/posts/annex/images/essays/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-009.png" alt="分布式架构-009"></p>
<p><code>SpringCloud Config</code>是配置中心的一种，它分为服务端和客户端两部分：</p>
<ul>
<li>服务端也称为分布式配置中心，它是一个独立的微服务应用，用来连接配置服务器并为客户端提供获取配置信息，加密/解密信息等访问接口；Config-Server端集中式存储/管理配置文件，并对外提供接口方便Config-Client访问，接口使用HTTP的方式对外提供访问；</li>
<li>客户端则是通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息配置服务器默认采用git来存储配置信息，这样就有助于对环境配置进行版本管理，并且可以通过git客户端工具来方便的管理和访问配置内容；</li>
</ul>
<p>使用<code>SpringCloud Config</code>非常简单，需要在服务端和客户端分别进行改造：</p>
<ol>
<li>引入依赖就不说了，首先将分布式中系统中的配置放到git或svn上，在服务端配置文件里配置好git或svn用户名密码、配置文件所在的分支及配置文件的目录，再将服务端启动类加上<code>@EnableConfigServer</code>注解，就大功告成了；</li>
<li>放在git或svn上的配置文件名称要符合规则，才能通过配置中心访问得到该文件。一些常用的配置文件规则，其中，label：分支、profiles：环境(dev/test/prod)、application：服务名：
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"> ## http://127.0.0.1:3344/master/config-dev.yml
 1. /{label}/{application}-{profile}.yml
   
 ## http://127.0.0.1:3344/config-dev.yml
 2. /{application}-{profile}.yml
   
 ## http://127.0.0.1:3344/config/dev/master
 3. /{application}/{profile}[/{label}]
</code></pre></div></li>
<li>在客户端也要引入依赖和进行相关配置：配置中心地址、分支名称、配置文件名称、环境，需要注意的是要将客户端模块下的<code>application.yml</code>文件改为<code>bootstrap.yml</code>，再将主启动类加上<code>@EnableEurekaClient</code>注解；
<blockquote>
<p>当配置客户端启动时，它绑定到配置服务器(通过spring.cloud.config.uri引导配置属性)，并使用远程属性源初始化Spring Environment。
这种行为的最终结果是，所有想要使用Config Server的客户端应用程序都需要bootstrap.yml或一个环境变量</p>
<p>applicaiton.yml是用户级的资源配置项,而bootstrap.yml是系统级的，优先级更加高，在加载配置时优先加载bootstrap.yml</p>
</blockquote>
</li>
</ol>
<p>当将<code>SpringCloud Config</code>客户端服务端都配置好之后，修改配置时会发现修改的配置文件不能实时生效；针对这个问题，可以将服务重启或者调用<code>actuator</code>的刷新接口使其生效，使用之前需要引入<code>actuator</code>的依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"> # 使用SpringCloud Config修改完配置后，调用刷新接口使客户端配置生效
 curl -X POST &#34;http://localhost:3355/actuator/refresh&#34;
</code></pre></div><p>为了避免手动的调用刷新接口，可以使用<code>SpringCloud Bus</code>配合<code>SpringCloud Config</code>实现配置的动态刷新。</p>
<h3 id="服务开发">服务开发</h3>
<p>长期以来 Java 的开发一直让人所诟病：项目开发复杂度极其高、项目的维护非常困难；即便使用了大量的开发框架，发现我们的开发也没少多少。为了解决让开发更佳简单，项目更容易管理，SpringBoot诞生了。</p>
<p>Spring Boot是一个广泛用来构建Java微服务的框架，它基于Spring依赖注入框架来进行工作。</p>
<h4 id="springboot">SpringBoot</h4>
<p>官网地址：<a href="https://spring.io/projects/spring-boot">https://spring.io/projects/spring-boot</a></p>
<blockquote>
<p><code>SpringBoot</code>是由<code>Pivotal</code>团队提供的全新框架，其设计目的是用来简化新<code>Spring</code>应用的初始搭建以及开发过程。
该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。<code>SpringBoot</code> 提供了一种新的编程范式，可以更加快速便捷地开发 <code>Spring</code> 项目，在开发过程当中可以专注于应用程序本身的功能开发，而无需在 <code>Spring</code> 配置上花太大的工夫。</p>
</blockquote>
<p><code>SpringBoot</code> 基于 <code>Sring4</code> 进行设计，继承了原有 <code>Spring</code> 框架的优秀基因。
<code>SpringBoot</code> 准确的说并不是一个框架，而是一些类库的集合。
<code>maven</code> 或者 <code>gradle</code> 项目导入相应依赖即可使用 <code>SpringBoot</code>，而无需自行管理这些类库的版本。</p>
<p>特点：</p>
<ul>
<li>独立运行的 <code>Spring</code> 项目：
<code>SpringBoot</code> 可以以 jar 包的形式独立运行，运行一个 <code>SpringBoot</code> 项目只需通过 <code>java–jar xx.jar</code> 来运行。</li>
<li>内嵌 <code>Servlet</code> 容器：
<code>SpringBoot</code> 可选择内嵌 <code>Tomcat</code>、<code>Jetty</code> 或者 <code>Undertow</code>，这样我们无须以 <code>war</code> 包形式部署项目。</li>
<li>提供 <code>starter</code> 简化 <code>Maven</code> 配置：
<code>Spring</code> 提供了一系列的 <code>starter</code> pom 来简化 <code>Maven</code> 的依赖加载，例如，当你使用了<code>spring-boot-starter-web</code> 时，会自动加入依赖包。</li>
<li>自动配置 <code>Spring</code>：
<code>SpringBoot</code> 会根据在类路径中的 jar 包、类，为 jar 包里的类自动配置 Bean，这样会极大地减少我们要使用的配置。当然，<code>SpringBoot</code> 只是考虑了大多数的开发场景，并不是所有的场景，若在实际开发中我们需要自动配置 <code>Bean</code>，而 <code>SpringBoot</code> 没有提供支持，则可以自定义自动配置。</li>
<li>准生产的应用监控：
<code>SpringBoot</code> 提供基于 <code>http、ssh、telnet</code> 对运行时的项目进行监控。</li>
<li>无代码生成和 xml 配置：
<code>SpringBoot</code> 的神奇的不是借助于代码生成来实现的，而是通过条件注解来实现的，这是 <code>Spring 4.x</code> 提供的新特性。<code>Spring 4.x</code> 提倡使用 Java 配置和注解配置组合，而 <code>SpringBoot</code> 不需要任何 xml 配置即可实现 <code>Spring</code> 的所有配置。</li>
</ul>
</div>
                    <div class="post_footer">
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    
                                    <a href="https://whiteppure.github.io/iblog/tags/java/">Java</a>
                                    
                                    <a href="https://whiteppure.github.io/iblog/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
                                    
                                    
                                    
                                    <span id="busuanzi_container_page_pv">
                                      阅读量<span id="busuanzi_value_page_pv"></span>次
                                    </span>
                                    
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                
<div class="doc_comments">
    <div class="comments_block_title">发表评论</div>
    <div id="vcomments"></div>
</div>

<link rel="stylesheet" href="https://whiteppure.github.io/iblog/css/comments.css" />

<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>


<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        appId: 'pRSrjsfbN6L1DUxgfqJWOMYP-gzGzoHsz',
        appKey: 'VPWpnDPGDM8Xhdlh5OvHOpak',
        placeholder: '说点什么吧...',
        visitor: 'true',
        
        emojiCDN: '//i0.hdslb.com/bfs/emote/',
        
        emojiMaps: {
            "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
            "tv_亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
            "tv_偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png",
            "tv_再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
            "tv_冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
            "tv_发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
            "tv_发财": "34db290afd2963723c6eb3c4560667db7253a21a.png",
            "tv_可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
            "tv_吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png",
            "tv_呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
            "tv_呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png",
            "tv_困": "241ee304e44c0af029adceb294399391e4737ef2.png",
            "tv_坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png",
            "tv_大佬": "093c1e2c490161aca397afc45573c877cdead616.png",
            "tv_大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
            "tv_委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
            "tv_害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
            "tv_尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
            "tv_微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
            "tv_思考": "90cf159733e558137ed20aa04d09964436f618a1.png",
            "tv_惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
            "tv_打脸": "56ab10b624063e966bfcb76ea5dc4794d87dfd47.png",
            "tv_抓狂": "fe31c08edad661d63762b04e17b8d5ae3c71a757.png",
            "tv_抠鼻": "c666f55e88d471e51bbd9fab9bb308110824a6eb.png",
            "tv_斜眼笑": "911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png",
            "tv_无奈": "ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png",
            "tv_晕": "5443c22b4d07fb1907ccc610c8e6db254f2461b7.png",
            "tv_流汗": "cead1c351ab8d79e9f369605beb90148db0fbed3.png",
            "tv_流泪": "7e71cde7858f0cd50d74b0264aa26db612a8a167.png",
            "tv_流鼻血": "c32d39db2737f89b904ca32700d140a9241b0767.png",
            "tv_点赞": "f85c354995bd99e28fc76c869bfe42ba6438eff4.png",
            "tv_生气": "26702dcafdab5e8225b43ffd23c94ac1ff932654.png",
            "tv_生病": "8b0ec90e6b86771092a498c54f09fc94621c1900.png",
            "tv_疑问": "0793d949b18d7be716078349c202c15ff166f314.png",
            "tv_白眼": "c1d59f439e379ee50eef488bcb5e5378e5044ea4.png",
            "tv_皱眉": "72ccad6679fea0d14cce648b4d818e09b8ffea2d.png",
            "tv_目瞪口呆": "0b8cb81a68de5d5365212c99375e7ace3e7891b7.png",
            "tv_睡着": "8b196675b53af58264f383c50ad0945048290b33.png",
            "tv_笑哭": "1abc628f6d4f4caf9d0e7800878f4697abbc8273.png",
            "tv_腼腆": "89712c0d4af73e67f89e35cbc518420380a7f6f4.png",
            "tv_色": "61822c7e9aae5da76475e7892534545336b23a6f.png",
            "tv_调侃": "4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png",
            "tv_调皮": "b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png",
            "tv_鄙视": "6e72339f346a692a495b123174b49e4e8e781303.png",
            "tv_闭嘴": "c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png",
            "tv_难过": "87f46748d3f142ebc6586ff58860d0e2fc8263ba.png",
            "tv_馋": "fc7e829b845c43c623c8b490ee3602b7f0e76a31.png",
            "tv_鬼脸": "0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png",
            "tv_黑人问号": "45821a01f51bc867da9edbaa2e070410819a95b2.png",
            "tv_鼓掌": "1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"
        }
    })
</script>

                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>whitepure@2022</span>
    </div>
</footer>
    <script src="https://whiteppure.github.io/iblog/js/jquery-3.5.1.min.js"></script>
<link href="https://whiteppure.github.io/iblog/css/fancybox.min.css" rel="stylesheet">
<script src="https://whiteppure.github.io/iblog/js/fancybox.min.js"></script>
<script src="https://whiteppure.github.io/iblog/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>




<script src="https://cdn.bootcdn.net/ajax/libs/jspdf/1.0.106/jspdf.debug.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

























































</body>

</html>